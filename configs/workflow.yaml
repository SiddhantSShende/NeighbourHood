# Workflow Service Configuration

server:
  port: 50053
  grpc:
    max_recv_msg_size: 16777216  # 16MB
    max_send_msg_size: 16777216  # 16MB
    keepalive:
      time: 30s
      timeout: 10s
  shutdown_timeout: 60s

database:
  host: ${DB_HOST:localhost}
  port: ${DB_PORT:5432}
  name: ${DB_NAME:neighbourhood_workflow}
  user: ${DB_USER:postgres}
  password: ${DB_PASSWORD:}
  ssl_mode: ${DB_SSL_MODE:disable}
  max_open_conns: 30
  max_idle_conns: 10
  conn_max_lifetime: 5m

redis:
  host: ${REDIS_HOST:localhost}
  port: ${REDIS_PORT:6379}
  password: ${REDIS_PASSWORD:}
  db: 2
  pool_size: 15

message_queue:
  type: rabbitmq  # rabbitmq, kafka
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    user: ${RABBITMQ_USER:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    vhost: /
    exchange: workflow_events
    queue: workflow_tasks
    prefetch_count: 10

workflow:
  max_concurrent_executions: 100
  default_timeout: 300s
  max_workflow_size_mb: 10
  max_steps_per_workflow: 50
  enable_parallel_execution: true
  
execution:
  worker_pool_size: 20
  task_queue_size: 1000
  step_timeout: 60s
  max_retries: 3
  retry_delay: 5s
  
scheduler:
  enabled: true
  check_interval: 30s
  max_scheduled_workflows: 1000

cache:
  workflow_ttl: 1h
  execution_ttl: 24h
  enable_caching: true

services:
  auth_service:
    address: ${AUTH_SERVICE_ADDR:localhost:50051}
    timeout: 10s
    retry_attempts: 3
  
  integration_service:
    address: ${INTEGRATION_SERVICE_ADDR:localhost:50052}
    timeout: 60s
    retry_attempts: 3
  
  consent_service:
    address: ${CONSENT_SERVICE_ADDR:localhost:50054}
    timeout: 10s
    retry_attempts: 3
  
  notification_service:
    address: ${NOTIFICATION_SERVICE_ADDR:localhost:50055}
    timeout: 10s
    retry_attempts: 2

logging:
  level: ${LOG_LEVEL:info}
  format: json
  output: stdout
  include_workflow_context: true

metrics:
  enabled: true
  port: 9092
  path: /metrics
  custom_metrics:
    - workflow_executions_total
    - workflow_duration_seconds
    - workflow_steps_executed
    - workflow_failures_total

tracing:
  enabled: ${TRACING_ENABLED:true}
  endpoint: ${JAEGER_ENDPOINT:http://localhost:14268/api/traces}
  service_name: workflow-service
  sample_rate: 0.2

health_check:
  enabled: true
  interval: 30s
  include_dependencies: true
